
# КОНСТИТУЦИЯ ПРОЕКТА VK MESSENGER AI
# (Обязательно к прочтению перед внесением любых изменений в код)

## 0. ВЫСШИЙ ПРИОРИТЕТ (PROTOCOL ZERO)
0.1. **Слово Пользователя — Закон.** Глобальная цель — удовлетворить запрос пользователя.
0.2. **Техническое Вето:** Если запрос технически невозможен или гарантированно сломает приложение, ОБЪЯСНИ и ПРЕДЛОЖИ РЕШЕНИЕ.
0.3. **Запрет на самоуправство:** Не удаляй функционал без команды.

## 1. ФОРМАТ ОБЩЕНИЯ И ФАЙЛОВ
1.1. **PYTHON ONLY IN .TXT:** Весь код на Python (файлы .py) передавать ТОЛЬКО с расширением **`.txt`**.
1.2. **NO CHAT CODE:** Код передается только в блоках `<changes>`.
1.3. **ЯЗЫК:** Русский.

## 2. БАЗА ДАННЫХ (DB INTEGRITY)
2.1. **Архитектура:** Один файл `main.db`.
2.2. **Режим (KAIZEN):**
    - `PRAGMA journal_mode = WAL` (Write-Ahead Logging) — ОБЯЗАТЕЛЬНО.
    - `PRAGMA synchronous = NORMAL`.
    - `timeout=60` при подключении.
    - `check_same_thread=False`.
2.3. **Миграции:** `DROP TABLE` ЗАПРЕЩЕН. Только `ALTER TABLE`.
2.4. **Lean SQL:** В циклах рассылки ЗАПРЕЩЕНО использовать `SELECT *`. Выбирать только необходимые поля (`SELECT id, status...`).

## 3. ВЗАИМОДЕЙСТВИЕ С VK (DOMAIN LOGIC)
3.1. **Fail-Fast:** Если токен невалиден или аккаунт забанен — помечать статус в БД и прекращать попытки использования этого аккаунта в текущем цикле. Не долбиться в API.
3.2. **Квоты:** Не тратить API-запросы на то, что можно проверить локально (например, является ли пользователь другом, если есть кэш).

## 4. ИНТЕРФЕЙС (UI STABILITY)
4.1. **Theme Lock:** Только Dark Theme.
4.2. **Layout:** Две колонки (Контент слева, Настройки справа).
4.3. **No Native Popups:** Использовать `ConfirmModal`.

## 5. СТРУКТУРА КОДА
5.1. **Модульность:** Разбивать код на функциональные блоки. Файлы > 300 строк делить.

## 6. ФОРМАТ ФАЙЛОВ
6.1. **Инструкция:** Файлы `.txt` переименовываются пользователем в `.py`.

## 7. HIGH-LOAD PROTOCOL (KAIZEN F1)
7.1. **Micro-Batching:** Воркеры не должны брать по 1 задаче. Используем захват пачками (по 5-10 шт) через `UPDATE ... WHERE id IN (SELECT ... LIMIT 5)`. Это снижает нагрузку на БД в разы.
7.2. **Jitter (Дрожание):** Все паузы и таймеры (особенно при старте и проверке времени) должны иметь случайную составляющую (`sleep(60 + random(0, 5))`), чтобы потоки не синхронизировались.
7.3. **Zero Waste:** Не создавать переменные и объекты, которые не используются. Экономия памяти.
